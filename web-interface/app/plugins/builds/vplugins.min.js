const Account=function(){"use strict";return{draw:function(t){!function(t){const e=V.getState("activeEntity"),n=CanvasComponents.list("narrow");for(let t=0;t<12;t++){const t=AccountComponents.accountPlaceholderCard(),e=CanvasComponents.card(t);V.setNode(n,e)}Button.draw("all",{fade:"out"}),Navigation.draw(t),Chat.drawMessageForm(),Page.draw({topcontent:e?AccountComponents.topcontent(e.fullId):"",listings:n,position:"top"})}(t),async function(t){const e=V.getState("activeEntity");if(!e)return;const n=await V.getTransaction();if(!n.success||!n.data.length)return{success:!1,aE:e,entityBalance:null};const a=await V.getEntityBalance(),s=[];for(const t of n.data.reverse())V.getState("activeAddress")||("fee"==t.txType?t.title="Transaction Fee":"generated"==t.txType&&(t.title="Community Payout")),s.push(t);return{success:!0,aE:e,entityBalance:a,data:s}}().then(t=>{!function(t){const e=CanvasComponents.list("narrow"),n=AccountComponents.topcontent(t.aE.fullId,t.entityBalance);if(t.success)for(const n of t.data){const t=AccountComponents.accountCard(n),a=CanvasComponents.card(t);V.setNode(e,a)}else V.setNode(e,CanvasComponents.notFound("transactions"));Page.draw({topcontent:n,listings:e})}(t)})},drawHeaderBalance:function(t,e){if(V.setNode("balance",""),t){const e=AccountComponents.headerBalance(t);V.setNode("balance",e)}else{const t=V.getState("activeEntity");V.getEntityBalance(t).then(t=>{const n=t.data[0]?t.data[0][e||"liveBalance"]:"n/a",a=AccountComponents.headerBalance(n);V.setNode("balance",a)})}}}}(),AccountComponents=function(){"use strict";function t(t,e){return V.i18n(t,"account components",e||"transaction details")+" "}function e(){V.getVisibility("user-nav")?(V.setState("active",{navItem:!1}),Chat.drawMessageForm("clear"),Marketplace.draw()):(Button.draw("all",{fade:"out"}),V.setAnimation("entity-nav","fadeOut",{duration:.1}),V.setAnimation("service-nav","fadeOut",{duration:.6}),V.setAnimation("user-nav","fadeIn",{duration:.2}))}function n(){V.setToggle(this.closest("li").querySelector(".card__bottom-right"))}function a(){V.setToggle(this.closest("div").querySelector("table"))}function s(){const t=V.castPathOrId(this.innerHTML);V.setState("active",{navItem:t}),V.setBrowserHistory(t),Profile.draw(t)}return{topcontent:function(e,n){return console.log(n),V.cN({t:"div",h:[{t:"h1",c:"font-bold txt-center pxy",k:a,h:e},n?{t:"table",i:"v-token-account-details",c:"hidden fs-s",h:[[t("Spendable"),V.setNetVAmount(n.data[0].liveBalance).net],[t("Gross"),n.data[0].liveBalance],[t("On Chain"),n.data[0].tokenBalance],[t("ETH"),n.data[0].coinBalance]].filter(t=>Array.isArray(t)).map(t=>V.cN({t:"tr",h:[{t:"td",h:t[0]},{t:"td",c:"txt-right",h:t[1]}]}))}:{t:"p",c:"hidden",h:V.i18n("no balance details","app")}]})},headerBalance:function(t){t=V.setNetVAmount(t).net;const n=V.getState("screen"),a=V.getState("activeAddress"),s="rgba("+n.brandPrimary+", 1)",i=a?"txt-green":"txt-brand-primary";return V.castNode({tag:"svg",a:{width:n.width>800?"66px":"54px",viewBox:"0 0 36 36"},html:`<circle stroke-dasharray="100" transform ="rotate(-90, 18, 18) translate(0, 36) scale(1, -1)" stroke-dashoffset="-200" cx="18" cy="18" r="15.91549430918954" fill="white" stroke="${s}" stroke-width="2.7"></circle>\n              <text class="font-medium fs-xxs ${i}" x="50%" y="59%">${t}</text>`,click:e})},accountBalance:function(){const t="rgba("+V.getState("screen").brandPrimary+", 1)";return V.castNode({tag:"li",class:"txt-anchor-mid",html:`<svg width="74px" viewBox="0 0 36 36"> +\n              <circle stroke-dasharray="100" transform ="rotate(-90, 18, 18) translate(0, 36) scale(1, -1)" stroke-dashoffset="-200" cx="18" cy="18" r="15.91549430918954" fill="white" stroke="${t}" stroke-width="2.7"></circle>\n              <text class="font-medium fs-xxs txt-green" x="50%" y="59%">3129</text>\n            </svg>`})},accountSmallCard:function(t,e){return V.castNode({tag:"li",classes:"pxy txt-center",html:`<div class="smallcard__container font-medium pxy">\n              <p class="font-medium pb-xs">${t}</p>\n              <div class="flex justify-center items-center circle-2 rounded-full border-shadow font-medium no-txt-select">\n                ${e[t]}\n              </div>\n            </div>`})},accountCard:function(e){let a="";switch(e.txType){case"in":a="#B4ECB4";break;case"out":a="#FFAACC";break;case"fee":a="lightblue";break;case"generated":a="green";break;default:a="gray"}const i=V.cN({t:"div",c:"contents"}),o=V.cN({t:"div",c:"card__top-left flex justify-center items-center pxy",h:{t:"div",c:"circle-3 flex justify-center items-center rounded-full cursor-pointer",a:{style:"background:"+a},k:n,h:{t:"div",c:"card__initials font-medium fs-xl txt-white no-txt-select",h:e.amount}}}),r=V.cN({t:"div",c:"card__top-right flex items-center pxy",h:{t:"h2",c:"font-bold fs-l leading-snug cursor-pointer",k:s,h:e.title}}),c=V.cN({t:"div",c:"card__bottom-left items-center",h:""}),l=V.cN({t:"div",c:"card__bottom-right hidden fs-s pxy capitalize",h:{t:"table",h:[e.blockDate?[t("date"),new Date(1e3*e.blockDate).toString().substr(4,11)]:void 0,e.blockDate?[t("time"),new Date(1e3*e.blockDate).toString().substr(15,6)]:void 0,[t("amount"),e.amount],"out"==e.txType?[t("fees"),e.feesBurned]:[t("fees"),"0"],"out"==e.txType?[t("contribution"),e.contribution]:[t("contribution"),"0"],e.block?[t("block"),e.block]:[t("date"),e.date],[t("from"),"none"!=e.fromAddress?e.fromEntity:e.from+" "+e.fromTag],[t("to"),"none"!=e.toAddress?e.toEntity:e.to+" "+e.toTag],[t("payout"),e.payout]].filter(t=>Array.isArray(t)).map(t=>V.cN({t:"tr",h:[{t:"td",h:t[0]},{t:"td",c:"txt-right",h:t[1]}]}))}});return V.setNode(i,[o,r,c,l]),i},accountPlaceholderCard:function(){const t=V.cN({t:"div",c:"contents placeholder"}),e=V.cN({t:"div",c:"card__top-left flex justify-center items-center pxy",h:V.cN({t:"div",c:"circle-3 rounded-full animated-background"})}),n=V.cN({t:"div",c:"relative animated-background",y:{height:"20px",width:"200px",top:"25px",left:"8px"}});return V.setNode(t,[e,n]),t}}}(),Chat=function(){"use strict";function t(){V.getNode(".messageform__response").innerHTML=""}function e(){const t=V.getNode(".messageform__input"),e=V.getNode(".messageform__response"),n=t.value;V.setMessageBot(n).then(n=>{n.success?"transaction"==n.endpoint?(V.setState("active",{transaction:n}),Modal.draw("confirm transaction")):t.value="":e.append(V.sN({t:"div",c:"messageform__respinner",s:{messageform__respinner:{color:"red",background:"white",padding:"2px 8px"}},h:n.status}))})}function n(t){if("/chat/everyone"==V.getState("active").navItem){const e=V.getNode("list"),n=V.getState("activeEntity");n&&n.fullId==t.sender&&(t.sender="Me");const a=ChatComponents.message(t);V.setNode(e,a),e.scrollTop=e.scrollHeight+75}}function a(t){const e=V.getNode("#typing_on_1");if(!e)return;const n=V.getNode("#typing_on_2"),a=e.innerHTML.split(" ")[0];function s(){e.innerHTML=""}function i(){n.innerHTML=""}!1===t?(s(),i()):a?t==a?(e.innerHTML=t+" is typing ...",setTimeout(s,4e3)):(n.innerHTML=t+" is typing ...",setTimeout(i,4e3)):(e.innerHTML=t+" is typing ...",setTimeout(s,4e3),i())}return{drawMessageForm:function(n){if(V.setNode(".messageform","clear"),"clear"==n)return;const a=V.getState("active").lastViewed,s=ChatComponents.messageForm(),i=ChatComponents.messageInput(a),o=ChatComponents.messageResponse(),r=InteractionComponents.sendBtn();r.addEventListener("click",e),i.addEventListener("focus",t),V.setState("active",{lastViewed:void 0}),V.setNode(s,[o,i,r]),V.setNode("page",s)},draw:function(t){var e;e=t,Navigation.draw(e),Page.draw({position:"top"}),VMap.draw(),async function(t){const e=V.getState("activeEntity"),n=await V.getMessage();return n.success&&n.data[0].length?e||"/chat/everyone"==t?{success:!0,status:"ok",data:[{which:t,messages:n.data[0],activeEntity:e||void 0}]}:{success:!1,status:"not logged in",data:[]}:{success:!1,status:"no messages found",data:[{which:t,messages:[],activeEntity:e||void 0}]}}(t).then(t=>{!function(t){const e=ChatComponents.topcontent(),n=CanvasComponents.list("narrow");t.success?t.data[0].messages.forEach(e=>{t.data[0].activeEntity&&t.data[0].activeEntity.fullId==e.sender&&(e.sender="Me");const a=ChatComponents.message(e);V.setNode(n,a)}):V.setNode(e,CanvasComponents.notFound("messages")),Page.draw({topcontent:e,listings:n,position:"top",scroll:"bottom"}),Chat.drawMessageForm()}(t)})},launch:function(){V.setNavItem("serviceNav",[{title:"Chat",path:"/chat/everyone",draw:function(){Chat.draw("/chat/everyone")}}]),"MongoDB"==V.getSetting("chatLedger")&&(window.socket.on("community message",n),window.socket.on("a user is typing",a))}}}(),ChatComponents=function(){"use strict";let t,e,n,a=!1,s=!1,i="";document.addEventListener("click",(function(t){p(t.target)}));function o(t,e){return V.i18n(t,"chat components",e)}function r(){this.style.height="0px",this.style.height=this.scrollHeight+"px"}function c(o){const r=window.event?o.keyCode:o.which;if(13==r&&V.i18n("search","trigger")==i.split(" ")[0])1==e.childElementCount?(this.value=i.split(" ")[0]+" "+e.querySelector(".ac-suggestion").getAttribute("data-val"),document.getElementById("send-message").click()):n&&(this.value=i.split(" ")[0]+" "+n.getAttribute("data-val"),document.getElementById("send-message").click());else if(13!=r||a)if(13!=r&&9!=r&&39!=r||!a)if(27==r&&a)p(),o.stopPropagation();else if(8==r&&s.length<3)p();else if(40!=r&&38!=r||!a){const e=V.checkForTriggers(this.value);if(e){const t=e.filter(t=>isNaN(t.toLowerCase()));t.shift();const n=function(){for(var t=e.length;t--;)if(-1!=e[t].indexOf("#"))return t}();i=n>=1?e.slice(0,n+1).join(" "):e.slice(0,e.indexOf(t[0])).join(" "),s=(n>=1?e.slice(n+1).filter(t=>isNaN(t)).join(" "):t.join(" ")).toLowerCase()}s&&!a&&(2==s.length&&s!=V.i18n("for","trigger")&&V.getQuery({query:s,role:"all"}).then(e=>{t=e.data,e.success&&function(t,e,n,s){a=!0;const i=function(t,e,n){const a=t.getBoundingClientRect();return V.cN({t:"div",c:"ac-suggestions absolute card-shadow bkg-white",y:{left:a.left+"px",bottom:a.height+20+"px",width:a.width+"px"},h:e.length?V.cN({t:"div",h:e.map(t=>h(t,n))}):m(n)})}(s,t,e);g("ac-suggestion","mouseout",(function(){const t=i.querySelector(".ac-suggestion.selected");t&&setTimeout((function(){t.className=t.className.replace("selected","")}),20)}),i),g("ac-suggestion","mouseover",(function(){const t=i.querySelector(".ac-suggestion.selected");t&&(t.className=t.className.replace("selected","")),this.className+=" selected"}),i),g("ac-suggestion","mousedown",(function(){f(this,"ac-suggestion")&&u(this.getAttribute("data-val"),n,s)}),i),V.setNode("page",i)}(t,s,i,this)}),4==s.length&&(s.substr(0,2),V.i18n("for","trigger"))),s&&a&&40!=r&&38!=r&&function(t,e){V.setNode(".ac-suggestions","");let n=0;for(let a=0;a<t.length;a++)t[a].fullId.toLowerCase().includes(e)&&(V.setNode(".ac-suggestions",h(t[a],e)),n+=1);n||V.setNode(".ac-suggestions",m(e))}(t,s)}else{let t;if(n)t=40==r?n.nextSibling:n.previousSibling,t?(n.classList.remove("selected"),t.classList.add("selected"),d(t.getAttribute("data-val"),i,this)):(n.classList.remove("selected"),this.value=i+" ",t=0);else{const n=e.querySelectorAll(".ac-suggestion");t=40==r?n[0]:n[n.length-1],t.classList.add("selected"),d(t.getAttribute("data-val"),i,this)}}else o.preventDefault(),1==e.childElementCount?u(e.querySelector(".ac-suggestion").getAttribute("data-val"),i,this):n&&u(n.getAttribute("data-val"),i,this);else o.preventDefault(),document.getElementById("send-message").click()}function l(t){e=V.getNode(".ac-suggestions"),e&&(n=e.getNode(".ac-suggestion.selected"));const o=window.event?t.keyCode:t.which;13!=o&&V.getState("activeEntity")&&"send"!=this.value.substring(0,4)&&window.socket.emit("user is typing",V.getState("activeEntity").fullId.split(" ")[0]),13==o?(t.preventDefault(),window.socket.emit("user is typing",!1)):40!=o&&38!=o||!a?9==o?t.preventDefault():8==o&&s.length<3?p():o>48&&o<58&&a&&(1==e.childElementCount?u(e.querySelector(".ac-suggestion").getAttribute("data-val"),i,this):n?u(n.getAttribute("data-val"),i,this):p()):t.preventDefault()}function d(t,e,n){if(null===t)return;const a=e+" "+t+" ";n.value=a}function u(t,e,n){d(t,e,n),p(),window.setTimeout((function(){n.focus()}),10)}function p(){a=!1,s=!1,i="",t=[],V.setNode(".ac-suggestions","clear")}function f(t,e){return t.classList?t.classList.contains(e):new RegExp("\\b"+e+"\\b").test(t.className)}function g(t,e,n,a){!function(t,e,n){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener(e,n)}(a||document,e,(function(e){for(var a,s=e.target||e.srcElement;s&&!(a=f(s,t));)s=s.parentElement;a&&n.call(s,e)}))}function h(t,e){const n=e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),a=new RegExp("("+n.split(" ").join("|")+")","gi"),s=t.profile.title,i=t.profile.tag;return V.cN({t:"div",c:"ac-suggestion",a:{"data-val":s+" "+i},h:s.replace(a,'<span class="txt-brand-primary font-bold">$1</span>')+' <span class="user-tag">'+i+"</span>"})}function m(t){return V.cN({t:"div",c:"ac-suggestion",h:'"'+t+'" '+o("not found")})}return V.setStyle({"chat-link a":{color:"rgba(var(--link), 1)"},messageform:{bottom:"0","border-top":"1px solid #e8e8ec",background:"rgba(var(--brandPrimary),1)",padding:"8px 5px","border-radius":"3px 3px 0 0"},messageform__input:{height:"37px",padding:"10px 15px",width:"87%",resize:"none","border-radius":"30px"},messageform__response:{position:"absolute",top:"-24px"},"ac-suggestions":{"text-align":"left",cursor:"default","max-height":"254px",overflow:"hidden","overflow-y":"auto","border-radius":"6px",padding:"9px 4px","font-size":"0.9em"},"ac-suggestion":{position:"relative",padding:"0 .6em","line-height":"23px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","font-size":"1.02em",color:"#333"},"ac-suggestion.selected":{color:"rgba(var(--brandPrimary), 1)","font-size":"1.05em","font-family":"IBM Plex Bold"}}),{topcontent:function(){return V.cN({t:"div",c:"w-full",h:[{t:"h2",c:"font-bold fs-l leading-snug txt-center w-full pxy",h:o("Chat with Everyone","chat title")},{t:"span",c:"block h-4 fs-s txt-center",i:"typing_on_1"},{t:"span",c:"block h-4 fs-s txt-center",i:"typing_on_2"}]})},message:function(t){let e=t.msg.length>70?"300px":t.msg.length<30?"220px":"245px";const n="Me"==t.sender?t.msg.match("You've sent")?"#c0d6b9":"#e0e7eb":"#f7f7f8",a=V.castLinks(t.msg);a.iframes.includes("iframe")&&(e="330px");const s="Me"==t.sender?{"margin-left":"auto",width:e}:{"margin-right":"auto",width:e};return V.castNode({tag:"li",classes:"w-screen pxy",y:s,html:'<message style="background:'+n+'" class="message__container flex card-shadow rounded bkg-white pxy"><div class="font-medium pxy">'+("Me"==t.sender?"":"<p onclick=\"Profile.draw('"+V.castPathOrId(t.sender)+"')\" >"+t.sender+"</p>")+'<p class="chat-link">'+a.iframes+"</p></div></message>"})},messageForm:function(){return V.sN({t:"div",c:"messageform flex items-center absolute w-full pxy card-shadow"})},messageInput:function(t){const e=V.getState("activeEntity");return V.sN({t:"textarea",c:"messageform__input mr-2",h:t?"send "+t+" 10":"",a:{placeholder:o(e?"Send message or funds":"Join first to send a message or funds","message textarea placeholder")},e:{keyup:c,keydown:l,input:r}})},messageSend:function(){return V.sN({t:"button",c:"circle-1 flex justify-center items-center rounded-full bkg-white",h:V.getIcon("send")})},messageResponse:function(){return V.sN({t:"div",c:"messageform__response"})}}}(),DataComponents=function(){"use strict";return{weatherCard:function(t,e){return V.setNode({tag:"div",classes:"contents",setStyle:{icon:{height:"80px",position:"relative",bottom:"3px",left:"2px"},forecast:{width:"57px","text-align":"-moz-center"}},html:'<div class="card__top-left flex justify-center items-center"><div class="circle-3 flex justify-center items-center rounded-full" style="background: antiquewhite; background-position: center center; background-size: cover;"><div class="card__initials font-bold fs-xxl txt-white"><img src="'+t.iconUrl+'"></div></div></div><div class="card__top-right flex items-center pxy"><h2 class="font-bold fs-l leading-snug">'+t.place+'</h2></div><div class="card__bottom-left items-center"><div class="circle-2 flex justify-center items-center rounded-full border-shadow font-medium no-txt-select">'+t.tempC+'</div><p class="card__unit fs-xxs">Now</p></div><div class="card__bottom-right pxy"><div class="flex justify-center items-center"><div class="forecast"><div style="background: antiquewhite;" class="circle-2 flex justify-center items-center rounded-full"><div><img class="icon" src="'+e.iconUrl.hr24+'"></div></div><p class="card__unit fs-xxs">'+e.tempC.hr24+'</p><p class="card__unit fs-xxs">Tomorrow</p></div><div class="forecast"><div style="background: antiquewhite;" class="circle-2 flex justify-center items-center rounded-full"><div><img class="icon" src="'+e.iconUrl.hr48+'"></div></div><p class="card__unit fs-xxs">'+e.tempC.hr48+'</p><p class="card__unit fs-xxs">'+e.date.hr48+'</p></div><div class="forecast"><div style="background: antiquewhite;" class="circle-2 flex justify-center items-center rounded-full"><div><img class="icon" src="'+e.iconUrl.hr72+'"></div></div><p class="card__unit fs-xxs">'+e.tempC.hr72+'</p><p class="card__unit fs-xxs">'+e.date.hr72+'</p></div><div class="forecast"><div style="background: antiquewhite;" class="circle-2 flex justify-center items-center rounded-full"><div><img class="icon" src="'+e.iconUrl.hr96+'"></div></div><p class="card__unit fs-xxs">'+e.tempC.hr96+'</p><p class="card__unit fs-xxs">'+e.date.hr96+"</p></div></div></div>"})},airCard:function(t){const e="#00E400",n="#FFFF00",a="#FF7E00",s="#FF0000",i="rgb(143, 63, 151)",o="#7E0023",r="Good",c="Moderate",l="Unhealthy for Sensitive Groups",d="Unhealthy",u="Very Unhealthy",p="Hazardous",f=t=>t<=50?{c:e,h:r}:t<=100?{c:n,h:c}:t<=150?{c:a,h:l}:t<=200?{c:s,h:d}:t<=300?{c:i,h:u}:t<=500?{c:o,h:p}:void 0;return V.setNode({tag:"div",classes:"contents",setStyle:{icon:{height:"80px",position:"relative",bottom:"3px",left:"2px"},forecast:{width:"57px","text-align":"-moz-center"}},html:'<div class="card__top-left flex justify-center items-center"><div class="circle-2 flex justify-center items-center rounded-full" style="background-color: '+f(t.pollution.aqius).c+';background-position: center center; background-size: cover;"></div></div><div class="card__top-right flex items-center pxy"><h2 class="font-bold fs-l leading-snug">'+t.city+'</h2></div><div class="card__bottom-left items-center"><div class="circle-2 flex justify-center items-center rounded-full border-shadow font-medium no-txt-select">'+t.pollution.aqius+'</div><p class="card__unit fs-xxs">US AQI</p></div><div class="card__bottom-right pxy"><p>'+f(t.pollution.aqius).h+"</p></div>"})}}}(),Data=function(){"use strict";return{launch:function(){V.setNavItem("serviceNav",[{title:"Data",path:"/data",use:{button:"search",form:"new entity",role:"data"},draw:function(){Data.draw("/data")}}])},draw:function(t){var e;e=t,Navigation.draw(e),Page.draw({position:"top"}),VMap.draw(),async function(t){const e=V.getState("map")||{lat:52.522,lng:13.383,zoom:12},n=Promise.resolve(V.getData("https://api.openweathermap.org/data/2.5/weather?lat="+e.lat.toFixed(4)+"&lon="+e.lng.toFixed(4)+"&appid=8cc2a6452c40044763dd503c9752fbdc","","http")),a=Promise.resolve(V.getData("https://api.openweathermap.org/data/2.5/forecast?lat="+e.lat.toFixed(4)+"&lon="+e.lng.toFixed(4)+"&appid=8cc2a6452c40044763dd503c9752fbdc","","http")),s=await Promise.all([{status:"fail"},n,a]),i=s[0],o=s[1].data[0],r=s[2].data[0];let c={city:"Sorry, could not get data",pollution:0};i&&"fail"!=i.status&&(c={city:"The current air pollution levels in "+i.data.city+"!",pollution:i.data.current.pollution});const l={place:"The weather in "+(""==o.name?"current map position":o.name)+"!",iconUrl:"http://openweathermap.org/img/wn/"+o.weather[0].icon+"@2x.png",temp:"Temperature: "+(o.main.temp-273.15).toFixed(1)+"°C / "+(9*(o.main.temp-273.15)/5+32).toFixed(1)+"°F",tempC:(o.main.temp-273.15).toFixed(0)+"°C",humidity:"Humidity: "+o.main.humidity,sky:o.weather[0].description,sunrise:'Sunrise: <object type="image/svg+xml" data="001-sunrise.svg"></object>'+new Date(o.sys.sunrise),sunset:"Sunset: "+new Date(o.sys.sunset)},d={date:{hr24:V.castTime(1e3*r.list[8].dt,"D MMM"),hr48:V.castTime(1e3*r.list[16].dt,"D MMM"),hr72:V.castTime(1e3*r.list[24].dt,"D MMM"),hr96:V.castTime(1e3*r.list[32].dt,"D MMM")},tempC:{hr24:(r.list[8].main.temp-273.15).toFixed(0)+"°C",hr48:(r.list[16].main.temp-273.15).toFixed(0)+"°C",hr72:(r.list[24].main.temp-273.15).toFixed(0)+"°C",hr96:(r.list[32].main.temp-273.15).toFixed(0)+"°C"},iconUrl:{hr24:"http://openweathermap.org/img/wn/"+r.list[8].weather[0].icon+"@2x.png",hr48:"http://openweathermap.org/img/wn/"+r.list[16].weather[0].icon+"@2x.png",hr72:"http://openweathermap.org/img/wn/"+r.list[24].weather[0].icon+"@2x.png",hr96:"http://openweathermap.org/img/wn/"+r.list[32].weather[0].icon+"@2x.png"}},u=CanvasComponents.list(),p=DataComponents.weatherCard(l,d),f=CanvasComponents.card(p);return V.setNode(u,f),{which:t,listings:u,position:"top"}}(t).then(t=>{var e;e=t,Navigation.draw(e.which),Page.draw(e)})}}}(),UserComponents=function(){"use strict";let t,e;const n={};function a(){n.entry=this.value?this.value:this.innerHTML,["edit","not valid"].includes(n.entry)&&(this.innerHTML="",this.value="")}function s(){let t,e;t=this.value?this.value:this.innerHTML,t=V.stripHtml(t);const a=this.getAttribute("title"),s=this.getAttribute("db");if(t!=n.entry){if(""==t)return this.innerHTML="edit",void p(s+"."+a,"");if(["facebook","twitter","telegram"].includes(a)){t=t.endsWith("/")?t.slice(0,-1):t;e=t.split("/").pop().replace("@","")}else e="email"==a?t.includes("@")?t.includes(".")?t:"not valid":""==t?"":"not valid":"website"==a?t.includes(".")?t:"not valid":["address","evm"].includes(a)?t.includes("0x")&&42==t.length?t:"not valid":"currentUTC"==a?isNaN(t)?"not valid":t:"description"==a&&t.length>2e3?"not valid":t;if("not valid"==e)return void(this.innerHTML="not valid");this.innerHTML=e,p(s+"."+a,e)}}function i(){n.location=this.value}function o(){const t=this.getAttribute("lat"),e=this.getAttribute("lng"),a=this.value;if(V.getNode(".location__curr").value=this.value,n.location.length&&""==a){const t=V.castRandLatLng();p("properties.baseLocation",{lat:t.lat,lng:t.lng,value:void 0,rand:!0})}else t&&(p("properties.baseLocation",{lat:t,lng:e,value:a,rand:!1}),this.removeAttribute("lat"),this.removeAttribute("lng"))}function r(){const t=this.getAttribute("title");p(this.getAttribute("db")+"."+t,this.getAttribute("value"))}function c(t){V.castImageUpload(t).then(t=>{if(t.success){const e=V.getState("activeEntity"),n=V.getCookie("last-active-uphrase").replace(/"/g,""),a=V.getState("imageUpload"),s=V.getState("tinyImageUpload");Object.assign(a,{entity:e.fullId}),Object.assign(s,{entity:e.fullId}),V.setEntity(e.fullId,{field:"thumbnail",data:a,auth:n}).then(()=>{V.setEntity(e.fullId,{field:"tinyImage",data:s,auth:n}),V.setNode("#img-upload-profile__label",V.i18n("Change this image","user profile","card entry")),V.setNode("#img-upload-profile__preview",""),V.setNode("#img-upload-profile__preview",V.cN({t:"img",y:{"max-width":"100%"},src:t.src}))})}})}function l(t,e){return CanvasComponents.card(t,e)}function d(e,n,a,s){const i=V.cN({t:"table",c:"w-full pxy",h:e.map(e=>{const i=t[n]?t[n][e]:void 0,o={t:"td",c:"capitalize",h:V.i18n(e,"user profile","card entry")},r=u({t:"td",c:"txt-right",a:{title:e,db:n},h:i}),c={t:"td",c:"txt-right"+(s?" "+s:""),h:i};let l=V.cN({t:"tr",h:[o,a?r:c]});return i||(l=a?V.cN({t:"tr",h:[o,r]}):""),l}).filter(t=>""!=t)});return i.firstChild?i:null}function u(t){return t.e={focus:a,blur:s},t.a?Object.assign(t.a,{contenteditable:"true"}):t.a={contenteditable:"true"},t.h||(t.h="edit"),t}function p(t,e){const n=V.getState("activeEntity");V.setEntity(n.fullId,{field:t,data:e,auth:V.getCookie("last-active-uphrase").replace(/"/g,"")})}function f(t){if("password"===this.type)this.type="text",this.previousSibling.innerHTML="",setTimeout((function(){t.target.setSelectionRange(0,9999)}),50);else{window.getSelection().removeAllRanges(),this.previousSibling.innerHTML="vx",this.type="password"}}function g(t,e=""){return V.cN({t:"div",c:"pxy "+e,h:[{t:"span",h:"vx"},{t:"input",c:e,a:{value:t,type:"password"},y:{width:"190px",padding:0},e:{focus:f,blur:f}}]})}return V.setStyle({"app-lang-selector":{display:"flex","justify-content":"space-evenly",width:"190px",padding:"25px 0"},"pool__funding-pie":{"stroke-width":"50",fill:"#ddd",stroke:"rgb(65, 183, 135)"},"pool__funding-chart":{margin:"23px 0 0 4px",transform:"rotate(-90deg)","border-radius":"50%",display:"block",background:"#ddd"},"pool__spending-pie":{"stroke-width":"50",fill:"#ddd",stroke:"rgb(99, 82, 185)"},"pool__spending-chart":{margin:"23px 0 0 4px",transform:"rotate(-90deg)","border-radius":"50%",display:"block",background:"#ddd"}}),{handleViewKeyFocus:f,caseUphraseNode:g,setData:function(n){t=n.entity,e=!!n.editable},topcontent:function(){return V.cN({t:"div",h:{tag:"h1",class:"font-bold txt-center pxy",html:t.fullId}})},descriptionCard:function(){const n=t.properties?t.properties.description:void 0;if(n||!n&&e){return l(V.cN(e?{t:"textarea",c:"w-full pxy",a:{rows:"6",title:"description",db:"properties"},e:{focus:a,blur:s},h:n||"edit"}:{t:"div",c:"pxy",h:V.castLinks(n.replace(/\n/g," <br>")).iframes}),"Description")}return""},uPhraseCard:function(){const e=t.private.uPhrase;if(e){return l(g(e),"Entity Management Key")}return""},evmAddressCard:function(){const e=t.evmCredentials?t.evmCredentials.address:void 0;if(e){return l(V.cN({t:"p",c:"pxy fs-s",h:e}),"Entity Ethereum Address")}return""},evmReceiverAddressCard:function(){let n=t.evmCredentials?t.evmCredentials.address:void 0;if(t.receivingAddresses&&t.receivingAddresses.evm&&(n=t.receivingAddresses.evm),n||!n&&e){return l(V.cN(e?u({t:"p",c:"pxy fs-s",a:{title:"evm",db:"receivingAddresses"},h:n}):{t:"p",c:"pxy fs-s",h:n}),"Receiving Ethereum Address")}return""},locationCard:function(){const n=t.properties?t.properties.baseLocation||t.properties.currentLocation:void 0;if(n||!n&&e){return l(V.cN({t:"table",c:"w-full pxy",h:[{t:"tr",h:[{t:"td",c:"capitalize",h:V.i18n("base location","user profile","card entry")},e?{t:"input",i:"user__loc",c:"location__base pxy w-full txt-right",a:{value:n},e:{focus:i,blur:o}}:{t:"p",c:"location__base pxy txt-right",h:n}]},{t:"tr",h:[{t:"td",c:"capitalize",h:V.i18n("current location","user profile","card entry")},e?{t:"input",c:"location__curr pxy w-full txt-right",a:{value:n},e:{focus:i}}:{t:"p",c:"location__curr pxy txt-right",h:n}]},{t:"tr",h:[{t:"td",c:"capitalize",h:V.i18n("current UTC offset","user profile","card entry")},e?u({t:"td",c:"txt-right",a:{title:"currentUTC",db:"properties"},h:t.properties?t.properties.currentUTC:void 0}):{t:"td",c:"txt-right",h:t.properties?t.properties.currentUTC:void 0}]}]}),"Location")}return""},entityCard:function(){return l(d(["title","tag","role"],"profile",!1,"capitalize"),"Entity")},entityListCard:function(t){return l(V.cN({t:"div",h:[{t:"h2",c:"pxy font-bold fs-l",h:t.fullId},g(t.private.uPhrase)]}),"")},financialCard:function(){const n=t.properties?t.properties.target:void 0;if(n||!n&&e){return l(d(["target","unit"],"properties",e),"Financial")}return""},socialCard:function(){const t=d(["facebook","twitter","telegram","website","email"],"social",e);return t?l(t,"Social"):""},preferredLangsCard:function(){const n=t.properties?t.properties.preferredLangs:void 0;if(n||!n&&e){return l(V.cN(e?u({t:"p",c:"pxy",a:{title:"preferredLangs",db:"properties"},h:n}):{t:"p",c:"pxy",h:n}),"Preferred Languages")}return""},appLanguageCard:function(){const n=t.properties&&t.properties.appLang?t.properties.appLang:"en_US";if(n||!n&&e){return l(V.cN({t:"div",c:"app-lang-selector",h:[{t:"input",a:{type:"radio",name:"app-lang",value:"en_US",title:"appLang",db:"properties",checked:"en_US"==n},k:r},{t:"span",h:"🇬🇧"},{t:"input",a:{type:"radio",name:"app-lang",value:"de_DE",title:"appLang",db:"properties",checked:"de_DE"==n},k:r},{t:"span",h:"🇩🇪"}]}),"App Language")}return""},fundingStatusCard:function(e,n){if("pool"==t.profile.role){const a={strPfPg432:V.i18n("Not yet successfully funded","user profile","pools"),strPfPg433:V.i18n("Successfully funded","user profile","pools"),strPfPg434:V.i18n("None yet spent","user profile","pools"),strPfPg435:V.i18n("Budget spent","user profile","pools")};let s="",i="",o=a.strPfPg432,r="",c=a.strPfPg434;const d=n>0?Math.floor(n/t.properties.target*100):0,u=n>0?Math.ceil(e*(1+V.getSetting("transactionFee")/1e4)/n*100):0;d>=0&&(s='<svg width="100" height="100" class="pool__funding-chart">               <circle r="25" cx="50" cy="50" class="pool__funding-pie" stroke-dasharray="'+Math.floor(d/100*158)+' 158"/>             </svg>'),d>66&&(o='<span class="">'+a.strPfPg433+"</span>"),u>=0&&(i='<svg width="100" height="100" class="pool__spending-chart">      <circle r="25" cx="50" cy="50" class="pool__spending-pie" stroke-dasharray="'+Math.floor(u/100*158)+' 158"/>      </svg>'),u>0&&(c='<span class="">'+a.strPfPg435+"</span>",r='<span class="">'+u+" %</span>");return l(V.cN({t:"table",c:"w-full pxy",h:[{t:"tr",h:[{t:"td",h:s},{t:"td",h:d+" %<br><br>"+o}]},{t:"tr",h:[{t:"td",h:i},{t:"td",h:r+"<br><br>"+c}]}]}),"Funding Status")}return""},thumbnailCard:function(){if(t.thumbnail){const e=V.castEntityThumbnail(t.thumbnail).img;return V.cN({t:"li",h:e})}return""},addOrChangeImage:function(){let e;const n=t.thumbnail;if(n){const t=V.castEntityThumbnail(n).img;e=V.castNode({t:"div",c:"pxy",h:[{t:"div",c:"pxy",h:[{t:"label",c:"pxy",i:"img-upload-profile__label",a:{for:"img-upload-profile__file"},h:V.i18n("Change this image","user profile","card entry")},{t:"input",i:"img-upload-profile__file",c:"hidden",a:{type:"file",accept:"image/*"},e:{change:c}}]},{t:"div",i:"img-upload-profile__preview",h:t}]})}else e=V.cN({t:"div",c:"pxy",h:[{t:"label",i:"img-upload-profile__label",a:{for:"img-upload-profile__file"},h:V.i18n("edit","user profile","placeholder")},{t:"input",i:"img-upload-profile__file",c:"hidden",a:{type:"file",accept:"image/*"},e:{change:c}},{t:"div",i:"img-upload-profile__preview"}]});return l(e,"Image")}}}(),Profile=function(){"use strict";return{draw:function(t){Button.draw("all",{fade:"out"}),Page.draw({position:"top"}),async function(t){const e=V.castPathOrId(t),n=await V.getEntity(e),a=[];if(n.success){V.setState("active",{lastViewed:n.data[0].fullId});let e,s=0,i=0;return"pool"==n.data[0].profile.role&&(V.getState("activeAddress")||!V.getState("activeEntity")?n.data[0].evmCredentials&&(e=await V.getAddressHistory(n.data[0].evmCredentials.address),e.success&&e.data.length&&e.data.forEach(t=>{"out"==t.txType&&(s+=Number(t.amount)),"in"==t.txType&&(i+=Number(t.amount))})):(n.data[0].stats||Object.assign(n.data[0],{stats:{sendVolume:0,receiveVolume:0}}),s=n.data[0].stats.sendVolume,i=n.data[0].stats.receiveVolume)),a.push({type:"Feature",geometry:n.data[0].geometry,profile:n.data[0].profile,thumbnail:n.data[0].thumbnail,path:n.data[0].path}),{success:!0,status:"entities retrieved",data:[{which:t,entity:n.data[0],sendVolume:s,receiveVolume:i,mapData:a}]}}return{success:null,status:"cound not retrieve entities"}}(t).then(t=>{!function(t){let e,n;t.success?(UserComponents.setData({entity:t.data[0].entity,editable:!1}),n=CanvasComponents.list("narrow"),e=UserComponents.topcontent(),V.setNode(n,[UserComponents.thumbnailCard(),UserComponents.entityCard(),UserComponents.fundingStatusCard(t.data[0].sendVolume,t.data[0].receiveVolume),UserComponents.financialCard(),UserComponents.descriptionCard(),UserComponents.locationCard(),UserComponents.socialCard(),UserComponents.preferredLangsCard(),UserComponents.evmAddressCard(),UserComponents.evmReceiverAddressCard()]),Navigation.draw(t.data[0].entity),Chat.drawMessageForm(),Page.draw({listings:n}),VMap.draw(t.data[0].mapData)):Page.draw({topcontent:CanvasComponents.notFound("entity")})}(t)})}}}(),User=function(){"use strict";return{draw:function(t){(async function(t){if("/me/disconnect"==t)return t;const e=V.getState("activeEntity");return e?{success:!0,status:"active entity retrieved",data:[{which:t,entity:V.getState("activeEntity"),mapData:[{type:"Feature",geometry:e.geometry,profile:e.profile,thumbnail:e.thumbnail,path:e.path}]}]}:{success:!1,status:""}})(t).then(t=>{!function(t){if("/me/disconnect"==t)return void Modal.draw("disconnect");let e,n;t.success?(UserComponents.setData({entity:t.data[0].entity,editable:!0}),n=CanvasComponents.list("narrow"),e=UserComponents.topcontent(),V.setNode(n,[InteractionComponents.onboardingCard(),UserComponents.entityCard(),UserComponents.socialCard(),UserComponents.addOrChangeImage(),UserComponents.descriptionCard(),UserComponents.locationCard(),UserComponents.preferredLangsCard(),UserComponents.financialCard(),UserComponents.evmAddressCard(),UserComponents.evmReceiverAddressCard(),UserComponents.uPhraseCard()]),Navigation.draw(t.data[0].which),Page.draw({topcontent:e,listings:n,position:"top"}).then(()=>{Google.launch().then(()=>{Google.initAutocomplete("user")})}),VMap.draw(t.data[0].mapData)):null===t.success?Page.draw({topcontent:CanvasComponents.notFound("entity")}):Marketplace.draw()}(t)})},launch:function(){V.setNavItem("userNav",[{title:"Transfers",path:"/me/transfers",use:{button:"search"},draw:function(t){Account.draw(t)}},{title:"Profile",path:"/me/profile",use:{button:"plus search"},draw:function(t){User.draw(t)}},{title:"Settings",path:"/me/settings",use:{button:"plus search"},draw:function(t){Settings.draw(t)}},{title:"Entities",path:"/me/entities",use:{button:"plus search"},draw:function(t){EntityList.draw(t)}},{title:"Disconnect",path:"/me/disconnect",draw:function(t){User.draw(t)}}])}}}(),EntityList=function(){"use strict";return{draw:function(t){var e;e=t,Navigation.draw(e),Page.draw({position:"top"}),async function(t){if(!V.getState("activeEntity"))return{success:!1,status:""};const e=V.getState("activeEntity").adminOf,n=[],a=[];for(let t=0;t<e.length;t++){const s=await V.getEntity(e[t]);n.push(s),a.push({type:"Feature",geometry:s.data[0].geometry,profile:s.data[0].profile,thumbnail:s.data[0].thumbnail,path:s.data[0].path})}return n[0]&&n[0].success?{success:!0,status:"entities retrieved",data:[{which:t,entity:V.getState("activeEntity"),entitiesAdmined:n,mapData:a}]}:{success:null,status:"cound not retrieve entities"}}(t).then(t=>{!function(t){let e,n;if(t.success){UserComponents.setData({entity:t.data[0].entity,editable:!0}),n=CanvasComponents.list("narrow"),e=UserComponents.topcontent();for(let e=0;e<t.data[0].entitiesAdmined.length;e++)V.setNode(n,[UserComponents.entityListCard(t.data[0].entitiesAdmined[e].data[0])]);Page.draw({topcontent:e,listings:n})}else Page.draw({topcontent:CanvasComponents.notFound("entity")})}(t)})}}}(),Settings=function(){"use strict";return{draw:function(t){(async function(t){return V.getState("activeEntity")?{success:!0,status:"active entity retrieved",data:[{which:t,entity:V.getState("activeEntity")}]}:{success:!1,status:""}})(t).then(t=>{!function(t){let e,n;t.success?(UserComponents.setData({entity:t.data[0].entity,editable:!0}),n=CanvasComponents.list("narrow"),e=UserComponents.topcontent(),V.setNode(n,[UserComponents.appLanguageCard()]),Navigation.draw(t.data[0].which),Page.draw({topcontent:e,listings:n,position:"top"})):Page.draw({topcontent:CanvasComponents.notFound("entity")})}(t)})}}}(),Google=function(){"use strict";function t(t){return t}function e(){}return{initAutocomplete:function(t){const e=document.getElementById(t+"__loc");if(e){const t=new google.maps.places.Autocomplete(e,{types:["geocode"]});t.addListener("place_changed",(function(){var n=t.getPlace();e.setAttribute("lat",n.geometry.location.lat().toFixed(5)),e.setAttribute("lng",n.geometry.location.lng().toFixed(5)),e.focus(),e.blur()}))}},launch:function(){if(document.getElementById("google-places-script"))return Promise.resolve();{const t=V.getApiKey("googlePlaces");if(t.length>10)return V.setScript("https://maps.googleapis.com/maps/api/js?key="+t+"&libraries=places&language=en&region=US","google-places-script");console.warn("Missing Google Places API key")}},draw:function(n){V.setPipe(t,e)(n)}}}(),VMap=function(){"use strict";let t,e;function n(n){if(V.getSetting("loadMap"))return V.getNode(".leaflet-pane")?Promise.resolve(n):async function(){await V.setScript("/plugins/dependencies/leaflet.js"),console.log("*** leaflet library loaded ***")}().then(()=>(function(){const n=V.getState("screen"),a={lat:6.9728,lng:-22.685,zoom:n.height>1200?3:2,maxZoom:16,minZoom:n.height>1200?3:2};e=L.geoJSON();const s=V.getCookie("map-state");if(s){const e=JSON.parse(s);t=L.map("background").setView([e.lat,e.lng],e.zoom),V.setState("map",{lat:e.lat,lng:e.lng,zoom:e.zoom})}else t=L.map("background").setView([a.lat,a.lng],a.zoom),V.setState("map",{lat:a.lat,lng:a.lng,zoom:a.zoom});L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',maxZoom:a.maxZoom,minZoom:a.minZoom}).addTo(t),t.on("moveend",(function(){const e=t.getBounds().getCenter();Object.assign(e,{zoom:t.getZoom()}),V.setState("map",e),V.setCookie("map-state",e)}))}(),n))}function a(n){if(!n||!n.length)return;const a=V.getState("screen"),s={radius:10,fillColor:"rgba("+a.brandPrimary+", 1)",weight:0,opacity:1,fillOpacity:.9},i={maxWidth:150,closeButton:!1,autoPanPaddingTopLeft:[100,140],keepInView:!0,className:"map__popup"};e&&e.remove(),e=L.geoJSON(n,{pointToLayer:function(t,e){return L.circleMarker(e,s)},onEachFeature:function(t,e){e.bindPopup(L.popup(i).setContent(function(t){return V.cN({t:"div",c:"",h:[{t:"p",c:"font-bold txt-center",h:t.profile.fullId},MarketplaceComponents.castCircle({thumbnail:t.thumbnail,profile:{title:t.profile.title},path:t.path}),{t:"p",c:"fs-s capitalize txt-center",h:t.profile.role}]})}(t)))}});const o=n[0].geometry.coordinates;if(1==n.length){const s=n[0].geometry.rand,i=a.width<800?0:s?45:.35,r=s?3:10;t.setView([o[1],o[0]-i],r),setTimeout(()=>{e.addTo(t)},1e3)}else t.setView([o[1]-9,o[0]],3),e.addTo(t)}return{draw:function(t){V.getSetting("loadMap")&&n(t).then(t=>{a(t)})}}}(),MarketplaceComponents=function(){"use strict";function t(){V.setState("active",{navItem:this}),V.setBrowserHistory(this),Profile.draw(this)}function e(e){const n=(t=>{const e=["rgba("+V.getState("screen").brandSecondary+", 1)"];if(t.thumbnail){return"url('"+V.castEntityThumbnail(t.thumbnail).src+"')"}return e[0]})(e);return V.cN({t:"div",c:"circle-3 flex justify-center items-center rounded-full cursor-pointer",a:{style:`background:${n}; background-position: center center; background-size: cover;margin: 0 auto;`},h:{t:"div",c:"card__initials font-bold fs-xl txt-white",h:n.includes("url")?"":V.castInitials(e.profile.title)},e:{click:t.bind(e.path)}})}return{castCircle:e,entitiesSmallCard:function(t){return V.cN({t:"li",c:"pxy",h:{t:"smallcard",c:"smallcard__container txt-center rounded bkg-white",h:e(t)}})},entitiesPlaceholder:function(){return V.cN({t:"li",c:"pxy",h:{t:"smallcard",c:"smallcard__container txt-center rounded bkg-white",h:V.cN({t:"div",c:"circle-3 rounded-full animated-background"})}})},cardContent:function(n){!n.properties&&(n.properties={});const a=V.cN({t:"div",c:"contents"}),s=V.cN({t:"div",c:"card__top-left flex justify-center items-center pxy",h:e(n),k:t.bind(n.path)}),i=V.cN({t:"div",c:"card__top-right flex items-center pxy",h:{t:"h2",c:"font-bold fs-l leading-snug cursor-pointer",h:n.fullId,k:t.bind(n.path)}}),o=V.cN({t:"div",c:"card__bottom-left items-center pxy",h:n.properties&&n.properties.target?[{t:"div",c:"circle-2 flex justify-center items-center rounded-full border-shadow font-medium no-txt-select",h:n.properties&&n.properties.target?n.properties.target:"",k:t.bind(n.path)},{t:"p",c:"card__unit fs-xxs",h:n.properties&&n.properties.unit?n.properties.unit:""}]:""}),r=V.cN({t:"div",c:"card__bottom-right pxy",h:[{t:"p",c:"capitalize",h:n.profile.role},{t:"p",h:n.properties&&n.properties.description?n.properties.description.substr(0,160):""},{t:"p",h:n.properties&&n.properties.baseLocation?n.properties.baseLocation:""}],k:t.bind(n.path)});return V.setNode(a,[s,i,o,r]),a}}}(),Marketplace=function(){"use strict";return{launch:function(){V.setNavItem("serviceNav",[{title:"Marketplace",path:"/market/all",use:{button:"search"},draw:function(t){Marketplace.draw(t)}},{title:"Places",path:"/market/places",use:{button:"plus search",form:"new entity",role:"place"},draw:function(t){Marketplace.draw(t)}},{title:"Jobs",path:"/market/jobs",use:{button:"plus search",form:"new entity",role:"job"},draw:function(t){Marketplace.draw(t)}},{title:"Skills",path:"/market/skills",use:{button:"plus search",form:"new entity",role:"skill"},draw:function(t){Marketplace.draw(t)}},{title:"Events",path:"/market/events",use:{button:"plus search",form:"new entity",role:"event"},draw:function(t){Marketplace.draw(t)}},{title:"Crowdfunding",path:"/pools",use:{button:"plus search",form:"new entity",role:"pool"},draw:function(t){Marketplace.draw(t)}}])},draw:function(t,e){!function(t){const e=CanvasComponents.slider();for(let t=0;t<20;t++){const t=MarketplaceComponents.entitiesPlaceholder();V.setNode(e,t)}t?(Navigation.draw(t),Button.draw(V.getNavItem("active",["serviceNav","entityNav"]).use.button,{delay:2})):Navigation.draw(),Page.draw({topslider:e,position:"peek"})}(t),async function(t,e){let n=(t?t.split("/"):["all"]).pop();["all","media"].includes(n)||(n=n.slice(0,-1));let a,s=!1;const i=V.getCache(n),o=Date.now();i&&o-i.timestamp<60*V.getSetting("marketCacheDuration")*1e3?a={success:!0,status:"cache used",elapsed:o-i.timestamp,data:V.castJson(i.data,"clone").reverse()}:e&&e.query?(Object.assign(e,{role:n}),s=!0,a=await V.getQuery(e),V.setCache(n,a.data)):(a=await V.getEntity(n),V.setCache(n,a.data));const r=[];return a.success?(a.data.forEach(t=>{r.push({type:"Feature",geometry:t.geometry,profile:t.profile,thumbnail:t.thumbnail,path:t.path})}),{success:!0,status:"entities retrieved",isSearch:s,data:[{whichPath:t,entities:a.data,mapData:r}]}):{success:!1,status:"cound not retrieve any entities",isSearch:s,data:[{whichPath:t,entities:a.data,mapData:r}]}}(t,e).then(t=>{!function(t){const e=CanvasComponents.slider(),n=CanvasComponents.list(),a=t.data[0];t.success?(t.isSearch&&(Form.draw("all",{fade:"out"}),Button.draw("all",{fade:"out"})),a.entities.reverse().forEach(t=>{const a=MarketplaceComponents.entitiesSmallCard(t),s=MarketplaceComponents.cardContent(t),i=CanvasComponents.card(s);V.setNode(e,a),V.setNode(n,i)})):(t.isSearch&&(Button.draw("all",{fade:"out"}),Button.draw("close query")),V.setNode(e,CanvasComponents.notFound("marketplace items"))),Page.draw({topslider:e,listings:n}),VMap.draw(a.mapData)}(t)})}}}(),MediaComponents=function(){"use strict";return V.setStyle({"iframe-wrapper":{position:"relative","padding-bottom":"56.25%"},"iframe-wrapper iframe":{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},"media-text a":{color:"rgba(var(--link), 1)"}}),{videoFeature:function(t){return V.castNode({t:"div",h:V.castLinks(t).iframes})},mediaCard:function(t){const e=V.cN({t:"media",c:"contents"}),n=V.cN({t:"p",c:"font-medium pxy",h:t.fullId}),a=V.castNode({t:"div",c:"w-full",h:V.castLinks(t.properties.description.replace(/\n/g," <br>")).firstIframe}),s=V.castNode({t:"div",c:"media-text pt-r",h:V.castLinks(t.properties.description.replace(/\n/g," <br>")).links});return V.setNode(e,[n,a,s]),e},featureUl:function(){return V.cN({tag:"ul"})}}}(),Media=function(){"use strict";function t(t){t.which&&Button.draw(V.getNavItem("active","serviceNav").use.button,{delay:2}),t.feature&&Feature.draw(t.feature),Page.draw(t),VMap.draw()}function e(e){(async function(t){const e=CanvasComponents.list(),n=await V.getEntity("/media/moocs"==t?"mooc":"media");return n.data?n.data.forEach(t=>{const n=MediaComponents.mediaCard(t),a=CanvasComponents.card(n);V.setNode(e,a)}):V.setNode(e,CanvasComponents.notFound("media items")),{which:t,listings:e}})(e).then(e=>{t(e)})}return{launch:function(){V.setNavItem("serviceNav",[{title:"Media",path:"/media",use:{button:"plus search",form:"new entity",role:"media"},draw:function(){Media.draw("/media",{feature:"https://youtu.be/5eTCZ9L834s"})}},{title:"Moocs",path:"/media/moocs",use:{button:"plus search",form:"new entity",role:"mooc"},draw:function(){Media.draw("/media/moocs",{feature:"https://youtu.be/ygJ4uu4XNM8"})}}])},draw:function(n,a){var s;s=n,Navigation.draw(s),function(t){const e=MediaComponents.featureUl(),n=MediaComponents.videoFeature(t&&t.feature?t.feature:"https://youtu.be/ygJ4uu4XNM8");V.setNode(e,n);const a={feature:e,position:"feature"};return Promise.resolve(a)}(a).then(e=>{t(e)}),setTimeout(e,2e3,n)}}}();